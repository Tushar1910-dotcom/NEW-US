<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HabitFlow - Transform Your Life</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #4a1d5f 50%, #1a1a2e 100%);
            min-height: 100vh;
            color: white;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .glass {
            background: rgba(17, 24, 39, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        .grid-bg {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjAzKSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+');
            opacity: 0.2;
        }
        .glow {
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(168, 85, 247, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(236, 72, 153, 0.4);
        }
    </style>
</head>
<body>
    <div class="fixed inset-0 grid-bg pointer-events-none"></div>
    
    <!-- Login Screen -->
    <div id="loginScreen" class="relative min-h-screen flex items-center justify-center p-4">
        <div class="glass rounded-3xl p-12 max-w-md w-full glow">
            <div class="text-center mb-8">
                <div class="inline-block p-4 bg-gradient-to-br from-purple-500 to-cyan-500 rounded-2xl mb-4">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent">
                    HabitFlow
                </h1>
                <p class="text-gray-400">Transform your life, one habit at a time</p>
            </div>
            
            <div id="googleSignInButton" class="flex justify-center mb-4"></div>
            
            <div class="text-center my-4">
                <span class="text-gray-500 text-sm">or</span>
            </div>
            
            <button onclick="demoLogin()" class="w-full bg-gradient-to-r from-purple-500 to-cyan-500 hover:from-purple-600 hover:to-cyan-600 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 flex items-center justify-center gap-3 shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                Try Demo Mode
            </button>
            
            <p class="text-xs text-gray-500 text-center mt-6">
                By continuing, you agree to our Terms of Service and Privacy Policy
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="glass border-b border-purple-500/20 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-gradient-to-br from-purple-500 to-cyan-500 rounded-xl">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent">
                            HabitFlow
                        </h1>
                    </div>
                    
                    <nav class="flex items-center gap-4">
                        <button onclick="showView('dashboard')" id="btnDashboard" class="px-4 py-2 rounded-lg transition-all bg-purple-500/20 text-purple-300">
                            Dashboard
                        </button>
                        <button onclick="showView('analytics')" id="btnAnalytics" class="px-4 py-2 rounded-lg transition-all text-gray-400 hover:text-white">
                            Analytics
                        </button>
                        <div class="flex items-center gap-2 ml-4 pl-4 border-l border-purple-500/20">
                            <img id="userAvatar" src="" alt="" class="w-8 h-8 rounded-full">
                            <span id="userName" class="text-sm text-gray-300"></span>
                            <button onclick="logout()" class="p-2 text-gray-400 hover:text-white transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                            </button>
                        </div>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Dashboard View -->
        <div id="dashboardView" class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Today's Mission</h2>
                <p class="text-gray-400" id="todayDate"></p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-lg font-semibold text-purple-300 mb-4">Good Habits</h3>
                    <p class="text-4xl font-bold" id="statGoodHabits">0</p>
                    <p class="text-sm text-gray-400 mt-2">Active habits</p>
                </div>
                <div class="glass rounded-2xl p-6 border-cyan-500/20">
                    <h3 class="text-lg font-semibold text-cyan-300 mb-4">Completion Rate</h3>
                    <p class="text-4xl font-bold" id="statCompletion">0%</p>
                    <p class="text-sm text-gray-400 mt-2">Today's progress</p>
                </div>
                <div class="glass rounded-2xl p-6 border-pink-500/20">
                    <h3 class="text-lg font-semibold text-pink-300 mb-4">Bad Habits</h3>
                    <p class="text-4xl font-bold" id="statBadHabits">0</p>
                    <p class="text-sm text-gray-400 mt-2">Avoiding today</p>
                </div>
            </div>

            <!-- Good Habits -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-purple-300">Good Habits</h3>
                    <button onclick="showAddModal('good')" class="btn-primary px-4 py-2 rounded-xl font-semibold flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Habit
                    </button>
                </div>
                <div id="goodHabitsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- Bad Habits -->
            <div>
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-pink-300">Bad Habits to Avoid</h3>
                    <button onclick="showAddModal('bad')" class="btn-danger px-4 py-2 rounded-xl font-semibold flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Habit
                    </button>
                </div>
                <div id="badHabitsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView" class="hidden relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <h2 class="text-3xl font-bold mb-8">Analytics & Insights</h2>

            <div class="glass rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-6 text-purple-300">Weekly Overview</h3>
                <canvas id="weeklyChart" height="100"></canvas>
            </div>

            <div class="glass rounded-2xl p-6 mb-8 border-cyan-500/20">
                <h3 class="text-xl font-bold mb-6 text-cyan-300">30-Day Completion Rate</h3>
                <canvas id="monthlyChart" height="100"></canvas>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-6 text-purple-300">Good Habits Performance</h3>
                    <div id="goodHabitsStats" class="space-y-4"></div>
                </div>
                <div class="glass rounded-2xl p-6 border-pink-500/20">
                    <h3 class="text-xl font-bold mb-6 text-pink-300">Bad Habits Tracking</h3>
                    <div id="badHabitsStats" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Modal -->
    <div id="addModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="glass rounded-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold mb-6" id="modalTitle">Add Habit</h3>
            <input type="text" id="habitNameInput" placeholder="e.g., Morning Exercise, Social Media" 
                   class="w-full bg-gray-900/50 border border-purple-500/30 rounded-xl px-4 py-3 mb-6 focus:outline-none focus:border-purple-500 transition-colors text-white">
            <div class="flex gap-3">
                <button onclick="addHabit()" class="flex-1 btn-primary py-3 rounded-xl font-semibold">Add Habit</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 py-3 rounded-xl font-semibold transition-all">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let goodHabits = [];
        let badHabits = [];
        let currentHabitType = 'good';
        let weeklyChart = null;
        let monthlyChart = null;

        // Demo Login Function
        function demoLogin() {
            currentUser = {
                id: 'demo_user',
                email: 'demo@habitflow.app',
                name: 'Demo User',
                picture: 'https://ui-avatars.com/api/?name=Demo+User&background=a855f7&color=fff&size=128'
            };

            // Show main app
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info in header
            document.getElementById('userAvatar').src = currentUser.picture;
            document.getElementById('userName').textContent = currentUser.name;
            
            // Load user data
            loadData();
            updateDashboard();
            updateDate();
        }

        // Google Sign-In Configuration
        function initGoogleSignIn() {
            google.accounts.id.initialize({
                client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with your actual client ID
                callback: handleCredentialResponse
            });

            google.accounts.id.renderButton(
                document.getElementById('googleSignInButton'),
                { 
                    theme: 'filled_blue',
                    size: 'large',
                    text: 'continue_with',
                    width: 300
                }
            );
        }

        function handleCredentialResponse(response) {
            // Decode JWT token to get user info
            const userInfo = parseJwt(response.credential);
            
            currentUser = {
                id: userInfo.sub,
                email: userInfo.email,
                name: userInfo.name,
                picture: userInfo.picture
            };

            // Show main app
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info in header
            document.getElementById('userAvatar').src = currentUser.picture;
            document.getElementById('userName').textContent = currentUser.name;
            
            // Load user data
            loadData();
            updateDashboard();
            updateDate();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        function logout() {
            google.accounts.id.disableAutoSelect();
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function loadData() {
            const storageKey = `habitflow_${currentUser.id}`;
            const stored = localStorage.getItem(storageKey);
            
            if (stored) {
                const data = JSON.parse(stored);
                goodHabits = data.goodHabits || [];
                badHabits = data.badHabits || [];
            } else {
                // Initialize with sample habits and demo data for new users
                const today = new Date();
                
                // Generate logs for the past 30 days with realistic patterns
                const generateGoodHabitLogs = (consistency) => {
                    const logs = [];
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - i);
                        const dateStr = date.toISOString().split('T')[0];
                        
                        // Add log based on consistency (0.7 = 70% completion rate)
                        if (Math.random() < consistency) {
                            logs.push({ 
                                date: dateStr, 
                                time: new Date(date.setHours(Math.floor(Math.random() * 12) + 6)).toISOString() 
                            });
                        }
                    }
                    return logs;
                };
                
                const generateBadHabitRelapses = (frequency) => {
                    const relapses = [];
                    for (let i = 29; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(date.getDate() - i);
                        const dateStr = date.toISOString().split('T')[0];
                        
                        // Add relapse based on frequency (0.15 = relapse 15% of days)
                        if (Math.random() < frequency) {
                            relapses.push({ 
                                date: dateStr, 
                                time: new Date(date.setHours(Math.floor(Math.random() * 16) + 8)).toISOString() 
                            });
                        }
                    }
                    return relapses;
                };
                
                // Good habits with demo data
                const meditationLogs = generateGoodHabitLogs(0.85);
                const exerciseLogs = generateGoodHabitLogs(0.70);
                const readingLogs = generateGoodHabitLogs(0.60);
                
                goodHabits = [
                    { 
                        id: Date.now(), 
                        name: 'Morning Meditation', 
                        logs: meditationLogs,
                        currentStreak: calculateStreak(meditationLogs).current,
                        longestStreak: calculateStreak(meditationLogs).longest
                    },
                    { 
                        id: Date.now() + 1, 
                        name: 'Exercise', 
                        logs: exerciseLogs,
                        currentStreak: calculateStreak(exerciseLogs).current,
                        longestStreak: calculateStreak(exerciseLogs).longest
                    },
                    { 
                        id: Date.now() + 2, 
                        name: 'Reading', 
                        logs: readingLogs,
                        currentStreak: calculateStreak(readingLogs).current,
                        longestStreak: calculateStreak(readingLogs).longest
                    }
                ];
                
                // Bad habits with demo data
                const socialMediaRelapses = generateBadHabitRelapses(0.20);
                const junkFoodRelapses = generateBadHabitRelapses(0.15);
                
                badHabits = [
                    { 
                        id: Date.now() + 3, 
                        name: 'Social Media Addiction', 
                        relapses: socialMediaRelapses,
                        daysSinceRelapse: calculateCleanStreak(socialMediaRelapses),
                        longestClean: 12
                    },
                    { 
                        id: Date.now() + 4, 
                        name: 'Junk Food', 
                        relapses: junkFoodRelapses,
                        daysSinceRelapse: calculateCleanStreak(junkFoodRelapses),
                        longestClean: 15
                    }
                ];
                
                saveData();
            }
        }

        function saveData() {
            if (!currentUser) return;
            const storageKey = `habitflow_${currentUser.id}`;
            localStorage.setItem(storageKey, JSON.stringify({ goodHabits, badHabits }));
        }

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('todayDate').textContent = new Date().toLocaleDateString('en-US', options);
        }

        function showView(view) {
            document.getElementById('dashboardView').classList.toggle('hidden', view !== 'dashboard');
            document.getElementById('analyticsView').classList.toggle('hidden', view !== 'analytics');
            document.getElementById('btnDashboard').classList.toggle('bg-purple-500/20', view === 'dashboard');
            document.getElementById('btnDashboard').classList.toggle('text-purple-300', view === 'dashboard');
            document.getElementById('btnDashboard').classList.toggle('text-gray-400', view !== 'dashboard');
            document.getElementById('btnAnalytics').classList.toggle('bg-purple-500/20', view === 'analytics');
            document.getElementById('btnAnalytics').classList.toggle('text-purple-300', view === 'analytics');
            document.getElementById('btnAnalytics').classList.toggle('text-gray-400', view !== 'analytics');
            
            if (view === 'analytics') {
                updateAnalytics();
            }
        }

        function showAddModal(type) {
            currentHabitType = type;
            document.getElementById('modalTitle').textContent = `Add ${type === 'good' ? 'Good' : 'Bad'} Habit`;
            document.getElementById('addModal').classList.remove('hidden');
            document.getElementById('habitNameInput').focus();
        }

        function closeModal() {
            document.getElementById('addModal').classList.add('hidden');
            document.getElementById('habitNameInput').value = '';
        }

        function addHabit() {
            const name = document.getElementById('habitNameInput').value.trim();
            if (!name) return;

            const newHabit = {
                id: Date.now(),
                name: name,
                ...(currentHabitType === 'good' 
                    ? { logs: [], currentStreak: 0, longestStreak: 0 }
                    : { relapses: [], daysSinceRelapse: 0, longestClean: 0 })
            };

            if (currentHabitType === 'good') {
                goodHabits.push(newHabit);
            } else {
                badHabits.push(newHabit);
            }

            saveData();
            updateDashboard();
            closeModal();
        }

        function deleteHabit(id, type) {
            if (!confirm('Are you sure you want to delete this habit?')) return;
            
            if (type === 'good') {
                goodHabits = goodHabits.filter(h => h.id !== id);
            } else {
                badHabits = badHabits.filter(h => h.id !== id);
            }
            saveData();
            updateDashboard();
        }

        function completeGoodHabit(id) {
            const today = new Date().toISOString().split('T')[0];
            const habit = goodHabits.find(h => h.id === id);
            if (!habit) return;

            const alreadyLogged = habit.logs.some(log => log.date === today);
            if (alreadyLogged) return;

            habit.logs.push({ date: today, time: new Date().toISOString() });
            habit.logs.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const streak = calculateStreak(habit.logs);
            habit.currentStreak = streak.current;
            habit.longestStreak = Math.max(streak.longest, habit.longestStreak);

            saveData();
            updateDashboard();
        }

        function relapseHabit(id) {
            const today = new Date().toISOString().split('T')[0];
            const habit = badHabits.find(h => h.id === id);
            if (!habit) return;

            habit.relapses.push({ date: today, time: new Date().toISOString() });
            habit.relapses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const cleanStreak = calculateCleanStreak(habit.relapses);
            habit.longestClean = Math.max(cleanStreak, habit.longestClean);
            habit.daysSinceRelapse = 0;

            saveData();
            updateDashboard();
        }

        function calculateStreak(logs) {
            if (logs.length === 0) return { current: 0, longest: 0 };
            
            let current = 0;
            let longest = 0;
            let tempStreak = 0;
            let expectedDate = new Date();

            for (let log of logs) {
                const logDate = new Date(log.date);
                const daysDiff = Math.floor((expectedDate - logDate) / (1000 * 60 * 60 * 24));
                
                if (daysDiff === 0 || daysDiff === 1) {
                    tempStreak++;
                    if (current === 0) current = tempStreak;
                    longest = Math.max(longest, tempStreak);
                    expectedDate = new Date(logDate);
                    expectedDate.setDate(expectedDate.getDate() - 1);
                } else {
                    tempStreak = 1;
                }
            }

            return { current, longest };
        }

        function calculateCleanStreak(relapses) {
            if (relapses.length === 0) return 0;
            const lastRelapse = new Date(relapses[0].date);
            const today = new Date();
            return Math.floor((today - lastRelapse) / (1000 * 60 * 60 * 24));
        }

        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            
            // Update stats
            document.getElementById('statGoodHabits').textContent = goodHabits.length;
            document.getElementById('statBadHabits').textContent = badHabits.length;
            
            const completed = goodHabits.filter(h => h.logs.some(l => l.date === today)).length;
            const completionRate = goodHabits.length > 0 ? Math.round((completed / goodHabits.length) * 100) : 0;
            document.getElementById('statCompletion').textContent = completionRate + '%';

            // Render good habits
            const goodList = document.getElementById('goodHabitsList');
            goodList.innerHTML = goodHabits.length === 0 
                ? '<div class="col-span-full glass rounded-2xl p-8 text-center text-gray-400">No good habits yet. Click "Add Habit" to start building!</div>'
                : goodHabits.map(habit => {
                    const isCompleted = habit.logs.some(log => log.date === today);
                    return `
                        <div class="glass rounded-2xl p-6 hover:border-purple-500/40 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <h4 class="font-semibold text-lg">${habit.name}</h4>
                                <button onclick="deleteHabit(${habit.id}, 'good')" class="text-gray-400 hover:text-red-400 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Current Streak</span>
                                    <span class="text-purple-300 font-semibold">${habit.currentStreak} days</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Longest Streak</span>
                                    <span class="text-purple-300 font-semibold">${habit.longestStreak} days</span>
                                </div>
                            </div>
                            <button onclick="completeGoodHabit(${habit.id})" ${isCompleted ? 'disabled' : ''} 
                                    class="w-full py-3 rounded-xl font-semibold transition-all duration-300 ${isCompleted ? 'bg-green-500/20 text-green-300 border border-green-500/30 cursor-not-allowed' : 'btn-primary cursor-pointer'}">
                                ${isCompleted ? 'âœ“ Completed' : 'Mark Complete'}
                            </button>
                        </div>
                    `;
                }).join('');

            // Render bad habits
            const badList = document.getElementById('badHabitsList');
            badList.innerHTML = badHabits.length === 0
                ? '<div class="col-span-full glass rounded-2xl p-8 text-center text-gray-400 border-pink-500/20">No bad habits tracked yet. Click "Add Habit" to start tracking!</div>'
                : badHabits.map(habit => {
                    const daysSince = calculateCleanStreak(habit.relapses);
                    return `
                        <div class="glass rounded-2xl p-6 hover:border-pink-500/40 transition-all border-pink-500/20">
                            <div class="flex justify-between items-start mb-4">
                                <h4 class="font-semibold text-lg">${habit.name}</h4>
                                <button onclick="deleteHabit(${habit.id}, 'bad')" class="text-gray-400 hover:text-red-400 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Days Clean</span>
                                    <span class="text-green-300 font-semibold">${daysSince} days</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Longest Clean</span>
                                    <span class="text-green-300 font-semibold">${habit.longestClean} days</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Total Relapses</span>
                                    <span class="text-pink-300 font-semibold">${habit.relapses.length}</span>
                                </div>
                            </div>
                            <button onclick="relapseHabit(${habit.id})" class="w-full py-3 rounded-xl font-semibold btn-danger">
                                Mark Relapse
                            </button>
                        </div>
                    `;
                }).join('');
        }

        function updateAnalytics() {
            // Weekly Chart
            const weeklyData = getWeeklyData();
            if (weeklyChart) weeklyChart.destroy();
            weeklyChart = new Chart(document.getElementById('weeklyChart'), {
                type: 'bar',
                data: {
                    labels: weeklyData.map(d => d.date),
                    datasets: [{
                        label: 'Good Habits',
                        data: weeklyData.map(d => d.good),
                        backgroundColor: 'rgba(168, 85, 247, 0.8)'
                    }, {
                        label: 'Bad Relapses',
                        data: weeklyData.map(d => d.bad),
                        backgroundColor: 'rgba(236, 72, 153, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: {
                        legend: { labels: { color: '#9ca3af' } }
                    }
                }
            });

            // Monthly Chart
            const monthlyData = getMonthlyData();
            if (monthlyChart) monthlyChart.destroy();
            monthlyChart = new Chart(document.getElementById('monthlyChart'), {
                type: 'line',
                data: {
                    labels: monthlyData.map(d => d.date),
                    datasets: [{
                        label: 'Completion %',
                        data: monthlyData.map(d => d.completion),
                        borderColor: '#22d3ee',
                        backgroundColor: 'rgba(34, 211, 238, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 100, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    },
                    plugins: {
                        legend: { labels: { color: '#9ca3af' } }
                    }
                }
            });

            // Good Habits Stats
            document.getElementById('goodHabitsStats').innerHTML = goodHabits.length === 0 
                ? '<p class="text-gray-400 text-center py-8">No good habits yet. Start building!</p>'
                : goodHabits.map(habit => `
                    <div class="border-b border-gray-700 pb-4 last:border-0">
                        <h4 class="font-semibold mb-2">${habit.name}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-400">Total Completions</p>
                                <p class="text-purple-300 font-semibold">${habit.logs.length}</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Current Streak</p>
                                <p class="text-purple-300 font-semibold">${habit.currentStreak} days</p>
                            </div>
                        </div>
                    </div>
                `).join('');

            // Bad Habits Stats
            document.getElementById('badHabitsStats').innerHTML = badHabits.length === 0
                ? '<p class="text-gray-400 text-center py-8">No bad habits tracked yet.</p>'
                : badHabits.map(habit => {
                    const daysSince = calculateCleanStreak(habit.relapses);
                    return `
                        <div class="border-b border-gray-700 pb-4 last:border-0">
                            <h4 class="font-semibold mb-2">${habit.name}</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-400">Days Clean</p>
                                    <p class="text-green-300 font-semibold">${daysSince} days</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Total Relapses</p>
                                    <p class="text-pink-300 font-semibold">${habit.relapses.length}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function getWeeklyData() {
            const data = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                
                const goodCompleted = goodHabits.filter(h => h.logs.some(l => l.date === dateStr)).length;
                const badRelapses = badHabits.filter(h => h.relapses.some(r => r.date === dateStr)).length;
                
                data.push({ date: dayName, good: goodCompleted, bad: badRelapses });
            }
            return data;
        }

        function getMonthlyData() {
            const data = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const completed = goodHabits.filter(h => h.logs.some(l => l.date === dateStr)).length;
                const completion = goodHabits.length > 0 ? Math.round((completed / goodHabits.length) * 100) : 0;
                
                data.push({ date: date.getDate(), completion });
            }
            return data;
        }

        // Enter key support
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('habitNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addHabit();
            });
        });

        // Initialize Google Sign-In when page loads
        window.onload = function() {
            initGoogleSignIn();
        };
    </script>
</body>
</html>
